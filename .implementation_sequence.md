
# Implementation Sequence: Luxaris API

## Phase 1: Foundation Setup

1. **Read core design documents:**
   - `luxaris-api/designs/design-general.md` - Store in memory, use for all API development
   - `luxaris-api/designs/design-tests.md` - Store in memory, use for all testing
   - `luxaris-api/designs/system/design-1-overview.md` - System context overview

2. **Implement high-level structure:**
   - Folder structure according to design-general.md
   - Initialize npm project with dependencies
   - Database migrations infrastructure setup (db-migrate)
   - Core infrastructure (server, middleware, logging, error handling)
   - Test infrastructure setup (Jest, Supertest, test utilities)
   - **Do NOT implement inner system aspects yet**
   - **Do NOT create entity migrations yet** (migrations created per feature in subsequent phases)

3. **Pause for confirmation**

---

## Phase 2: System Context Implementation (with Tests)

4. **Implement system designs sequentially:**
   - Follow numbered order: `design-2-identity.md`, `design-3-access-control.md`, etc.
   - **For each design:**
     1. Create database migration file for entities in this design:
        - Example: `20251125-create-users-table.sql` for design-2-identity.md
        - Example: `20251125-create-permissions-tables.sql` for design-3-access-control.md
        - One migration file per design to separate concerns
        - Run migration to create tables
     2. Implement the feature/module (repositories, services, use cases, routes)
     3. Implement corresponding tests immediately:
        - API integration tests (primary focus)
        - Domain logic tests (if applicable)
        - Repository tests (database operations)
     4. Verify all tests pass before moving forward
   - **Pause for confirmation between each design implementation**

---

## Phase 3: Posts Context Implementation (with Tests)

5. **Read product overview:**
   - `luxaris-api/designs/product/design-1-overview.md` - Understand product context

6. **Implement product designs sequentially:**
   - Follow numbered order: `design-2-channels.md`, `design-3-posts.md`, etc.
   - **For each design:**
     1. Read corresponding flow files from `designs/flows/`
        - Example: When implementing `design-3-posts.md`, read all `flow-*-post.md` files
     2. Create database migration file for entities in this design:
        - Example: `20251126-create-channels-tables.sql` for design-2-channels.md
        - Example: `20251126-create-posts-tables.sql` for design-3-posts.md
        - One migration file per design to separate concerns
        - Run migration to create tables
     3. Implement the feature/module (repositories, services, use cases, routes)
     4. Implement corresponding tests immediately:
        - API integration tests for all flow scenarios
        - Domain logic tests
        - Repository tests
     5. Verify all tests pass before moving forward
   - **Pause for confirmation between each design implementation**

---

## Testing Approach (Continuous Throughout Implementation)

- **Test-Driven Development (TDD)**: Write tests alongside feature implementation, not after
- **Test Coverage**: Focus on high coverage for critical paths (authentication, API endpoints)
- **Test Priority**:
  1. API integration tests (validate complete flows)
  2. Repository tests (verify database operations)
  3. Domain logic tests (business rules)
- **Sanity Testing**: Verify interface outcomes rather than exhaustive unit testing
- **Test Cleanup**: Always clean up test data (delete side effects after each test)
- **Follow**: `luxaris-api/designs/design-tests.md` for complete testing guidelines

---

## Database Migration Strategy (Continuous Throughout Implementation)

- **One Migration Per Design**: Each design document gets its own migration file
- **Separation of Concerns**: Group related tables together (identity, ACL, posts, etc.)
- **Naming Convention**: `YYYYMMDD-description.sql` or use db-migrate naming
  - Example: `20251125-create-users-and-sessions.sql`
  - Example: `20251125-create-acl-tables.sql`
  - Example: `20251126-create-posts-tables.sql`
- **Migration Order**: Follow the implementation sequence (system context â†’ product context)
- **Incremental Changes**: Each feature gets its tables created just before implementation
- **Rollback Support**: Always provide DOWN migration for reversibility
- **Testing**: Test migrations in development before running in other environments